<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Shopping Scraper API Documentation</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
    <link rel="icon" type="image/png" href="https://petstore.swagger.io/favicon-16x16.png" sizes="16x16" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }
        
        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }
        
        body {
            margin: 0;
            background: #fafafa;
        }
        
        .swagger-ui .topbar {
            background-color: #2c3e50;
            border-bottom: 1px solid #34495e;
        }
        
        .swagger-ui .topbar .download-url-wrapper {
            display: none;
        }
        
        .custom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 0;
        }
        
        .custom-header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .custom-header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .compliance-notice {
            background: #e8f5e8;
            border: 1px solid #d4edda;
            border-radius: 4px;
            padding: 15px;
            margin: 20px;
            color: #155724;
        }
        
        .compliance-notice h3 {
            margin-top: 0;
            color: #0c5460;
        }
        
        .compliance-notice ul {
            margin-bottom: 0;
        }
        
        .performance-metrics {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 20px;
            color: #856404;
        }
        
        .performance-metrics h3 {
            margin-top: 0;
            color: #533f03;
        }
    </style>
</head>
<body>
    <div class="custom-header">
        <h1>ü§ñ AI Shopping Scraper API</h1>
        <p>Intelligent e-commerce data acquisition for AI agent integration</p>
    </div>
    
    <div class="compliance-notice">
        <h3>üõ°Ô∏è Industry Standards Compliance</h3>
        <p>This API is designed according to the standards defined in <strong>SCRAPING_REQUIREMENTS.md</strong>:</p>
        <ul>
            <li><strong>Performance:</strong> API responses &lt; 200ms, scraping requests &lt; 5 minutes</li>
            <li><strong>Security:</strong> JWT authentication, input validation, rate limiting</li>
            <li><strong>Ethics:</strong> Respects robots.txt, implements proper delays, legal compliance</li>
            <li><strong>Reliability:</strong> Graceful degradation, circuit breakers, comprehensive error handling</li>
            <li><strong>Monitoring:</strong> Structured logging, health checks, performance metrics</li>
        </ul>
    </div>
    
    <div class="performance-metrics">
        <h3>üéØ Performance Targets</h3>
        <ul>
            <li><strong>Health Checks:</strong> &lt; 50ms response time</li>
            <li><strong>API Queries:</strong> &lt; 200ms response time</li>
            <li><strong>Complex Queries:</strong> &lt; 1000ms response time</li>
            <li><strong>Scraping Tasks:</strong> &lt; 5 minutes end-to-end</li>
            <li><strong>Throughput:</strong> 1000+ concurrent API requests</li>
            <li><strong>Availability:</strong> 99.9% uptime target</li>
        </ul>
    </div>
    
    <div id="swagger-ui"></div>
    
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"></script>
    
    <script>
        window.onload = function() {
            // Determine the OpenAPI spec URL
            const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const specUrl = isLocal 
                ? './openapi.yaml'  // Local development
                : 'https://raw.githubusercontent.com/Pdamadon/codesight-scraping-ai-generation/main/docs/api/openapi.yaml'; // Production
            
            const ui = SwaggerUIBundle({
                url: specUrl,
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                
                // Customization
                docExpansion: "list",
                defaultModelsExpandDepth: 2,
                defaultModelExpandDepth: 2,
                showExtensions: true,
                showCommonExtensions: true,
                
                // OAuth configuration (if needed in future)
                oauth2RedirectUrl: window.location.origin + "/docs/api/oauth2-redirect.html",
                
                // Custom request interceptor for adding correlation IDs
                requestInterceptor: function(request) {
                    // Add correlation ID header for tracing
                    request.headers['X-Correlation-ID'] = 'swagger-ui-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    
                    // Add timestamp for performance monitoring
                    request.headers['X-Request-Time'] = new Date().toISOString();
                    
                    return request;
                },
                
                // Response interceptor for performance monitoring
                responseInterceptor: function(response) {
                    // Log slow responses (development only)
                    if (isLocal && response.headers && response.headers['x-response-time']) {
                        const responseTime = parseFloat(response.headers['x-response-time'].replace('ms', ''));
                        if (responseTime > 200) {
                            console.warn(`Slow API response: ${responseTime}ms (target: <200ms)`);
                        }
                    }
                    
                    return response;
                },
                
                // Try it out enabled by default
                tryItOutEnabled: true,
                
                // Filter operations
                filter: true,
                
                // Syntax highlighting
                syntaxHighlight: {
                    activate: true,
                    theme: "agate"
                }
            });
            
            // Add custom styling after UI loads
            setTimeout(() => {
                // Hide the Swagger logo
                const logo = document.querySelector('.swagger-ui .topbar-wrapper img');
                if (logo) {
                    logo.style.display = 'none';
                }
                
                // Add custom title to topbar
                const topbar = document.querySelector('.swagger-ui .topbar');
                if (topbar) {
                    const title = document.createElement('div');
                    title.innerHTML = '<h2 style="color: white; margin: 0; padding: 10px;">AI Shopping Scraper API</h2>';
                    topbar.appendChild(title);
                }
            }, 1000);
        };
        
        // Performance monitoring for development
        if (window.location.hostname === 'localhost') {
            // Monitor performance of API calls made through Swagger UI
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const startTime = performance.now();
                
                return originalFetch(...args).then(response => {
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    
                    console.log(`API Call: ${args[0]} - ${duration.toFixed(2)}ms`);
                    
                    // Warn about slow responses
                    if (duration > 200) {
                        console.warn(`‚ö†Ô∏è Slow response: ${duration.toFixed(2)}ms (target: <200ms)`);
                    }
                    
                    return response;
                }).catch(error => {
                    console.error('API Call failed:', args[0], error);
                    throw error;
                });
            };
        }
    </script>
</body>
</html>